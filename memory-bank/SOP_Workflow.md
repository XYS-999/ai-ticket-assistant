# SOP_Workflow（企业级开发流程真相源）

## 0. 本文件目的
1. 固化本项目的开发流程，使每次迭代都可复现、可审查、可沉淀。
2. 引入 skills 思想：把“提示词 + 步骤 + 验收”标准化，避免 AI 输出发散。
3. 约束工作方式：按 PR（Pull Request，拉取请求）粒度推进，每个 PR 都必须可验证。

## 1. 工作原则（硬规则）
1. PR 粒度：一次 PR 只做一个主题（一个功能/一个基础设施改动/一个配置改动）。
2. 先只读摸底，再动手修改：任何改动前必须先输出仓库现状摘要与改动计划。
3. 可验证优先：每个 PR 必须给出“本机可复现”的验收命令与预期现象。
4. 证据链完整：每天记录到 DAILY_LOG；每个 PR 有描述、验收步骤、风险与回滚说明。
5. 面试导向：优先沉淀工程化资产（文档、测试、可观测、Compose、一键启动、CI）。

## 2. 工具分工（什么时候用什么）
### 2.1 GPT 聊天（架构/拆分/教材/复盘）
1. 用于：明确本 PR 目标、输出改动计划、解释技术栈、整理知识点、复盘风险与回滚。
2. 输出要求：必须产出“改动点清单 + 验收清单 + 风险点”。

### 2.2 Codex（连接 GitHub，批量实现）
1. 用于：按“改动点清单”修改多个文件、生成样板代码、补测试骨架。
2. 禁止：未做只读摸底就直接改；跨主题大改；一次 PR 改太多模块。
3. 输出要求：给出修改了哪些文件、为什么改、如何验证。

### 2.3 VS Code 聊天窗口（局部问题）
1. 用于：解释某段代码、修复当前报错、对单文件做小范围修改。
2. 禁止：在 VS Code 聊天里做大范围规划与跨目录重构（容易失控）。

### 2.4 CLI（命令行，验收与证据）
1. 用于：构建/测试/启动/接口调用/查看日志/运行 compose。
2. 输出要求：每个 PR 至少记录一组“命令 + 预期输出/现象”。

## 3. 目录改动范围（默认白名单）
1. 允许改：src/、memory-bank/、.github/、scripts/、docker/（若存在）。
2. 不允许改：refs/（本地参考目录，必须写入 .gitignore，不提交）。
3. 如需新增目录：必须先在 PR 计划中说明原因与用途。

## 4. 提示词规范（skills 思想落地）
### 4.1 统一约束块（每次给 Codex/GPT 都要粘贴）
1. 本次工作目标（1 句话）。
2. 本次允许改动的目录白名单。
3. 必须先只读摸底：先总结现状，再给改动计划，再开始修改。
4. 一次 PR 只做一个主题，禁止顺手重构。
5. 必须给出验收命令（Windows CMD 版）与预期结果。
6. 必须补充必要文档：README/ENV/DAILY_LOG/PR 描述（按需）。

### 4.2 标准输出结构（模型必须按此输出）
1. 现状摘要（Repo 结构/相关文件/约束）。
2. 改动计划（文件级别：改哪些文件，新增哪些文件，每项原因）。
3. 实现步骤（按顺序，不跳步）。
4. 验收清单（命令 + 预期现象）。
5. 风险点与回滚方案（最少 1 条）。

## 5. PR 开发流程（固定步骤）
### Step 0：定义本 PR 验收标准
1. 写清楚：本 PR 做什么、不做什么。
2. 写清楚：怎么证明完成（Swagger 调通/测试通过/命令跑通/日志可见）。

### Step 1：只读摸底（Read-only Recon）
1. 查看相关文档：PRD/TechDesign/ENV/AGENTS/SOP。
2. 查看仓库结构与现状（不改代码）。
3. 输出：现状摘要 + 风险点。

### Step 2：计划先行（Plan-first）
1. 输出文件级改动清单（改哪些文件、原因、边界）。
2. 明确影响面：接口/数据库/配置/日志/测试。
3. 输出：验收清单（至少 1 条可复现命令）。

### Step 3：实现（Implement）
1. 优先用 Codex 按清单修改。
2. 过程中遇到局部问题再用 VS Code 聊天窗口。
3. 禁止超范围改动：若发现需要扩展范围，必须回到 Step 2 更新计划。

### Step 4：验收（Verify）
1. 用 CLI 跑验收命令。
2. 收集证据：命令、关键输出、Swagger/日志现象。
3. 若失败：记录失败现象与下一步，不合并。

### Step 5：记录与提交（Document & Submit）
1. 在 DAILY_LOG 追加：今日完成、验收证据、知识点、遗留。
2. 提交前自检：变更是否符合 PR 主题；是否遗漏文档/测试。
3. 在 GitHub 发 PR：填写变更点、验收方式、风险与回滚。

## 6. 质量门禁（每个 PR 必须满足）
1. 能构建（Build）：至少不破坏现有构建流程。
2. 能运行（Run）：至少能启动或能被 Swagger/MockMvc 验证。
3. 能验证（Verify）：提供命令 + 预期结果（可复现）。
4. 有记录（Record）：DAILY_LOG 有对应条目。
5. 有边界（Scope）：一次 PR 一个主题，目录白名单不越界。

## 7. 文档同步规则
1. ENV.md：记录环境与版本（安装/升级工具后必须更新）。
2. TechDesign.md：记录技术方案与模块边界（结构变化时更新）。
3. AGENTS.md：记录协作规则（流程升级时同步精简条款）。
4. DAILY_LOG.md：每天追加记录（不回头重写历史）。

## 8. 术语表（出现英文缩写必须解释）
1. PR（Pull Request，拉取请求）
2. SOP（Standard Operating Procedure，标准作业流程）
3. CLI（Command Line Interface，命令行界面）
4. JWT（JSON Web Token，JSON 网络令牌）
5. RBAC（Role-Based Access Control，基于角色的访问控制）
6. API（Application Programming Interface，应用程序接口）
7. CI（Continuous Integration，持续集成）
8. Logs（日志）、Metrics（指标）、Tracing（追踪）
